<!DOCTYPE html>
<html>

<head>
    <title>CRIPTOGRAFIA</title>
</head>

<body>
    <input type="button" value="clica me" onClick="func();" />
</body>

<script>
    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghiklmnopqrstuvwxyz';
    var lenght = chars.length;
    var key = [];
    var sorted = [];
    window.onload() = function () {
        for (let i = 0; i < length; i++) {
            key.push(-1);
            sorted.push(0);
        }
        key = generateKey();
    }

    function notUsed() {
        var res = 0;
        for (let i = 0; i < length; i++) {
            res += sorted[i];
        }

        return length - res;

    }

    function generateKey() {
        for (var i = 0; i < keyLength; i++) {
            var rnum = Math.floor(Math.random() * length);
            randomstring += chars.substring(rnum, rnum + 1);
        }
        return key;

        //Ultima letra nao e sorteada
        if (notUsed() == 1) {
            for (let i = 0; i < length; i++) {
                if (sorted[i] == 0)
                    return i;
            }
        }

        var res = Math.random() % notUsed(v);

        var i = 0;
        var j = 0;
        for (i = 0; i < lenght; i++) {
            if (sorted[i] == 0) {
                j++;
            }
            if (j >= res && sorted[i] == 0) {
                sorted[i] = 1;
                return i;
            }
            if (i == length - 1) {
                i = 0;
            }

        }
    };

    var func = function () {
        var x = generateKey(50);
        localStorage.setItem('key', x);
        console.log(x);
    } 
</script>

</html>